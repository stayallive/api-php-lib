clone:
  path: github.com/stayallive/plesk-php-api

cache:
  mount:
    - vendor

compose:
  plesk:
    image: plesk/plesk:17.0

build:
  test-php70:
    image: tetraweb/php:7.0
    commands:
      - docker-php-ext-enable zip mbstring pcntl
      - php -v
      - composer self-update --no-progress
      - composer install --no-progress --no-scripts
      - until $(curl --output /dev/null --silent --insecure --head --fail $REMOTE_URL); do printf '.' sleep 5 done
      - php vendor/bin/phpunit --colors=never
    environment:
      - REMOTE_URL=https://127.0.0.1:8443
      - REMOTE_PASSWORD=changeme
